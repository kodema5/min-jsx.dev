{
  "version": 3,
  "sources": ["global-externals:react", "global-externals:react-dom", "../src/channel.js", "../src/last.js", "../src/app.jsx"],
  "sourcesContent": ["export default React;\nconst { Children, Component, Fragment, Profiler, PureComponent, StrictMode, Suspense, __SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED, cloneElement, createContext, createElement, createFactory, createRef, forwardRef, isValidElement, lazy, memo, startTransition, unstable_act, useCallback, useContext, useDebugValue, useDeferredValue, useEffect, useId, useImperativeHandle, useInsertionEffect, useLayoutEffect, useMemo, useReducer, useRef, useState, useSyncExternalStore, useTransition, version } = React;\nexport { Children, Component, Fragment, Profiler, PureComponent, StrictMode, Suspense, __SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED, cloneElement, createContext, createElement, createFactory, createRef, forwardRef, isValidElement, lazy, memo, startTransition, unstable_act, useCallback, useContext, useDebugValue, useDeferredValue, useEffect, useId, useImperativeHandle, useInsertionEffect, useLayoutEffect, useMemo, useReducer, useRef, useState, useSyncExternalStore, useTransition, version };", "export default ReactDOM;\nconst { __SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED, createPortal, createRoot, findDOMNode, flushSync, hydrate, hydrateRoot, render, unmountComponentAtNode, unstable_batchedUpdates, unstable_renderSubtreeIntoContainer, version } = ReactDOM;\nexport { __SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED, createPortal, createRoot, findDOMNode, flushSync, hydrate, hydrateRoot, render, unmountComponentAtNode, unstable_batchedUpdates, unstable_renderSubtreeIntoContainer, version };", "export class Channel {\r\n    listeners = {}\r\n    anonId = 0\r\n\r\n    _on(id, fn) {\r\n        let id_ = id.split('.')[1]\r\n            ? ''\r\n            : ('.' + String(++this.anonId))\r\n        id = id + id_\r\n        this.listeners[id] = fn\r\n        return id\r\n    }\r\n\r\n    on(ls) {\r\n        return Object\r\n            .entries(ls)\r\n            .map(([id, fn]) => this._on(id,fn))\r\n    }\r\n\r\n    _off(id) {\r\n        return (id in this.listeners)\r\n            && (delete this.listeners[id])\r\n    }\r\n\r\n    off(ids) {\r\n        return ids.map( id => this._off(id))\r\n    }\r\n\r\n    _post(id, data) {\r\n        return Object.entries(this.listeners)\r\n            .filter( ([k,_]) => k.split('.')[0]===id)\r\n            .map( ([_,f]) => f)\r\n            .filter(Boolean)\r\n            .map( async (f) => f(data))\r\n            .length\r\n    }\r\n\r\n    post(msgs) {\r\n        return Object\r\n            .entries(msgs)\r\n            .map( ([id,data]) => this._post(id, data))\r\n            .reduce( (s, n) => s+n, 0)\r\n    }\r\n}\r\n", "export let Last = globalThis.Last = class Last {\r\n\r\n    constructor(id, value = {}) {\r\n        let me = this\r\n        me.id = id\r\n        me.initialValues = {...value}\r\n\r\n        me.values = JSON.parse(sessionStorage.getItem(me.id))\r\n        if (!me.values || Object.keys(me.values).length===0) {\r\n            me.values = {...(me.initialValues)}\r\n        }\r\n\r\n\r\n        me.reset = () => {\r\n            me.values = {...(me.initialValues)}\r\n        }\r\n\r\n\r\n        me.set = (prop, value) => {\r\n            if (prop==='values') {\r\n                Object.assign(me.values, {...value})\r\n            } else {\r\n                me.values[prop] = value\r\n            }\r\n            return value\r\n        }\r\n\r\n\r\n        addEventListener('beforeunload',() => {\r\n            sessionStorage.setItem(\r\n                me.id,\r\n                JSON.stringify(this.values)\r\n            )\r\n        })\r\n\r\n\r\n        return new Proxy(me, {\r\n            set(obj, prop, value) {\r\n                obj.set(prop, value)\r\n            },\r\n            get(obj, prop) {\r\n                return prop==='values' ? obj.values\r\n                    : obj.values.hasOwnProperty(prop) ? obj.values[prop]\r\n                    : Reflect.get(...arguments)\r\n            },\r\n            has(obj, prop) {\r\n                return prop in obj.values\r\n            },\r\n            delete(obj, prop) {\r\n                return obj.values[prop]\r\n            }\r\n        })\r\n    }\r\n}\r\n", "import * as React from 'react'\r\nimport { createRoot } from 'react-dom'\r\nimport { Channel } from './channel'\r\nimport { Last } from './last'\r\n\r\nlet last = new Last('app', { state:'world' })\r\n\r\nexport let appChannel = new Channel()\r\n\r\nlet App = () => {\r\n\r\n    let [state, setState_] = React.useState(last.state)\r\n    let setState = (a) => setState_(last.set('state', a))\r\n\r\n\r\n    React.useEffect(() => {\r\n        let psId = appChannel.on({\r\n            'message': (data) => setState(data),\r\n        })\r\n        return () => appChannel.off(psId)\r\n    }, [])\r\n\r\n\r\n    return <>\r\n        <div className='container'>\r\n        <div className=\"row\"><div className=\"col\">\r\n        <h1>Hello, {state}!</h1>\r\n\r\n        <button\r\n            className=\"btn btn-primary\"\r\n            onClick={() => {\r\n                setTimeout(() => {\r\n                    appChannel.post({\r\n                        'message': (new Date()).toLocaleString(),\r\n                    })\r\n                }, 10)\r\n            }}\r\n            title=\"simulate external js call.\"\r\n        >post a local time</button>\r\n\r\n        <button\r\n            className=\"btn btn-primary ms-2\"\r\n            onClick={() => {\r\n                last.reset()\r\n                setState(last.state)\r\n            }}\r\n        >reset values</button>\r\n\r\n        <button\r\n            className=\"btn btn-primary ms-2\"\r\n            onClick={() => {\r\n                document.location.reload()\r\n            }}\r\n        >reload page</button>\r\n\r\n\r\n        </div></div></div>\r\n    </>\r\n}\r\n\r\nlet root = createRoot(document.getElementById('root'))\r\nroot.render(<App />)\r\n"],
  "mappings": "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",
  "names": ["react_default", "Children", "Component", "Fragment", "Profiler", "PureComponent", "StrictMode", "Suspense", "__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED", "cloneElement", "createContext", "createElement", "createFactory", "createRef", "forwardRef", "isValidElement", "lazy", "memo", "startTransition", "unstable_act", "useCallback", "useContext", "useDebugValue", "useDeferredValue", "useEffect", "useId", "useImperativeHandle", "useInsertionEffect", "useLayoutEffect", "useMemo", "useReducer", "useRef", "useState", "useSyncExternalStore", "useTransition", "version", "react_dom_default", "__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED", "createPortal", "createRoot", "findDOMNode", "flushSync", "hydrate", "hydrateRoot", "render", "unmountComponentAtNode", "unstable_batchedUpdates", "unstable_renderSubtreeIntoContainer", "version", "Channel", "__publicField", "id", "fn", "id_", "ls", "ids", "data", "k", "_", "f", "msgs", "n", "Last", "id", "value", "me", "prop", "obj", "last", "Last", "appChannel", "Channel", "App", "state", "setState_", "useState", "setState", "a", "useEffect", "psId", "data", "createElement", "Fragment", "root", "createRoot"]
}
